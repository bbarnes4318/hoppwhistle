services:
  api:
    image: docker-api
    container_name: hopwhistle-api
    restart: always
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - PORT=3001
      - HOST=0.0.0.0
      - JWT_SECRET=${JWT_SECRET:-35353535}
      - DATABASE_URL=postgresql://callfabric:callfabric_dev@hopwhistle-postgres-dev:5432/callfabric
      - REDIS_URL=redis://redis:6379
      - CLICKHOUSE_URL=http://hopwhistle-clickhouse-dev:8123
      - S3_ENDPOINT=http://hopwhistle-minio-dev:9000
      - S3_BUCKET=${S3_BUCKET:-recordings}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minioadmin}
      - S3_SECRET_KEY=${S3_SECRET_KEY:-minioadmin}
      - S3_REGION=${S3_REGION:-us-east-1}
      - S3_FORCE_PATH_STYLE=true
      - DEEPGRAM_API_KEY=${DEEPGRAM_API_KEY}
      - TELNYX_API_KEY=${TELNYX_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    ports:
      - '3001:3001'
    networks:
      - docker_hopwhistle-network

  worker:
    image: docker-worker
    container_name: hopwhistle-worker
    restart: always
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://callfabric:callfabric_dev@hopwhistle-postgres-dev:5432/callfabric
      - REDIS_URL=redis://redis:6379
      - CLICKHOUSE_URL=http://hopwhistle-clickhouse-dev:8123
    networks:
      - docker_hopwhistle-network

  web:
    image: docker-web
    container_name: hopwhistle-web
    restart: always
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - HOSTNAME=0.0.0.0
      - PORT=3000
      - NEXT_PUBLIC_API_URL=https://hopwhistle.com
    ports:
      - '3000:3000'
    networks:
      - docker_hopwhistle-network

networks:
  docker_hopwhistle-network:
    external: true
